#!/bin/bash

#LICENSE: https://github.com/sakibulalikhan/pentestbox/blob/main/LICENSE

echo -e "▄▄▄▄▄▄▄ ▄▄▄     ▄▄▄▄▄▄ ▄▄▄▄▄▄▄ ▄▄▄   ▄ ▄▄▄▄▄▄▄ ▄▄▄▄▄▄▄ ▄▄   ▄▄   "
echo -e "█  ▄    █   █   █      █       █   █ █ █  ▄    █       █  █▄█  █ "
echo -e "█ █▄█   █   █   █  ▄   █       █   █▄█ █ █▄█   █   ▄   █       █ "
echo -e "█       █   █   █ █▄█  █     ▄▄█      ▄█       █  █ █  █       █ "
echo -e "█  ▄   ██   █▄▄▄█      █    █  █     █▄█  ▄   ██  █▄█  ██     █  "
echo -e "█ █▄█   █       █  ▄   █    █▄▄█    ▄  █ █▄█   █       █   ▄   █ "
echo -e "█▄▄▄▄▄▄▄█▄▄▄▄▄▄▄█▄█ █▄▄█▄▄▄▄▄▄▄█▄▄▄█ █▄█▄▄▄▄▄▄▄█▄▄▄▄▄▄▄█▄▄█ █▄▄█ "
echo -e "+---------------------------------------------------------------+"
echo -e "|                   Author : @sakibulalikhan                    |"
echo -e "+---------------------------------------------------------------+\n"

command_exists() {
    command -v "$1" >/dev/null 2>&1
}

container_exists() {
    local container_name="$1"
    docker inspect -f '{{.State.Running}}' "$container_name" 2>/dev/null
}

if ! command_exists "distrobox"; then
    echo "distrobox command not found. Installing..."
    wget -qO- https://raw.githubusercontent.com/89luca89/distrobox/main/install | sudo sh
fi

if [ "$#" -eq 0 ] || [ "$1" == "start" ]; then
    echo "Starting services..."
    sudo systemctl start docker
    sudo chmod 666 /var/run/docker.sock
    if ! container_exists "blackbox"; then
        echo "Error response from daemon: No such container: blackbox"
        echo "Cannot find container blackbox"
        read -p "Create it now, out of image blackarchlinux/blackarch? [Y/n]: " create_container
        if [ "$create_container" == "Y" ] || [ "$create_container" == "y" ]; then
            distrobox create -n blackbox -i blackarchlinux/blackarch
        else
            echo "Ok. For creating it, run this command:"
            echo "  distrobox create -n <name-of-container> -i <image>"
        fi
    fi
    distrobox enter blackbox
elif [ "$1" == "stop" ]; then
    echo "Stopping services..."
    distrobox stop blackbox
elif [ "$1" == "remove" ]; then
    echo "Removing container blackbox..."
    if container_exists "blackbox"; then
        distrobox rm blackbox
    else
        echo "Container blackbox does not exist."
    fi
elif [ "$1" == "help" ]; then
    echo "Usage: ./blackbox [start|stop|remove|help]"
    echo "  ./blackbox start  : Start the blackbox services"
    echo "  ./blackbox stop   : Stop the blackbox services"
    echo "  ./blackbox remove : Remove the blackbox container"
    echo "  ./blackbox help   : Show the help message for blackbox"
else
    echo "Invalid command. Use './blackbox help' for usage information."
fi
