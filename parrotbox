#!/bin/bash

#LICENSE: https://github.com/sakibulalikhan/pentestbox/blob/main/LICENSE

echo -e " ▄▄▄▄▄▄▄ ▄▄▄▄▄▄ ▄▄▄▄▄▄   ▄▄▄▄▄▄   ▄▄▄▄▄▄▄ ▄▄▄▄▄▄▄ ▄▄▄▄▄▄▄ ▄▄▄▄▄▄▄ ▄▄   ▄▄  "
echo -e "█       █      █   ▄  █ █   ▄  █ █       █       █  ▄    █       █  █▄█  █ "
echo -e "█    ▄  █  ▄   █  █ █ █ █  █ █ █ █   ▄   █▄     ▄█ █▄█   █   ▄   █       █ "
echo -e "█   █▄█ █ █▄█  █   █▄▄█▄█   █▄▄█▄█  █ █  █ █   █ █       █  █ █  █       █ "
echo -e "█    ▄▄▄█      █    ▄▄  █    ▄▄  █  █▄█  █ █   █ █  ▄   ██  █▄█  ██     █  "
echo -e "█   █   █  ▄   █   █  █ █   █  █ █       █ █   █ █ █▄█   █       █   ▄   █ "
echo -e "█▄▄▄█   █▄█ █▄▄█▄▄▄█  █▄█▄▄▄█  █▄█▄▄▄▄▄▄▄█ █▄▄▄█ █▄▄▄▄▄▄▄█▄▄▄▄▄▄▄█▄▄█ █▄▄█ "
echo -e "+-------------------------------------------------------------------------+"
echo -e "|                        Author : @sakibulalikhan                         |"
echo -e "+-------------------------------------------------------------------------+\n"

command_exists() {
    command -v "$1" >/dev/null 2>&1
}

container_exists() {
    local container_name="$1"
    docker inspect -f '{{.State.Running}}' "$container_name" 2>/dev/null
}

if ! command_exists "distrobox"; then
    echo "distrobox command not found. Installing..."
    wget -qO- https://raw.githubusercontent.com/89luca89/distrobox/main/install | sudo sh
fi

if [ "$#" -eq 0 ] || [ "$1" == "start" ]; then
    echo "Starting services..."
    sudo systemctl start docker
    sudo chmod 666 /var/run/docker.sock
    if ! container_exists "parrotbox"; then
        echo "Error response from daemon: No such container: parrotbox"
        echo "Cannot find container parrotbox"
        read -p "Create it now, out of image parrotsec/security? [Y/n]: " create_container
        if [ "$create_container" == "Y" ] || [ "$create_container" == "y" ]; then
            distrobox create -n parrotbox -i parrotsec/security
        else
            echo "Ok. For creating it, run this command:"
            echo "  distrobox create -n <name-of-container> -i <image>"
        fi
    fi
    distrobox enter parrotbox
elif [ "$1" == "stop" ]; then
    echo "Stopping services..."
    distrobox stop parrotbox
elif [ "$1" == "remove" ]; then
    echo "Removing container kalibox..."
    if container_exists "kalibox"; then
        distrobox rm kalibox
    else
        echo "Container kalibox does not exist."
    fi
elif [ "$1" == "help" ]; then
    echo "Usage: ./parrotbox [start|stop|help]"
    echo "  ./parrotbox start  : Start the parrotbox services"
    echo "  ./parrotbox stop   : Stop the parrotbox services"
    echo "  ./parrotbox remove : Remove the parrotbox container"
    echo "  ./parrotbox help   : Show the help message for parrotbox"
else
    echo "Invalid command. Use './parrotbox help' for usage information."
fi
